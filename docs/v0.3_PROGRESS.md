# v0.3 - Widget Configuration

**Date:** January 10, 2026  
**Status:** Complete

## Overview

Implemented widget editor panel with schema-driven forms, specialized input components (Duration, HSL Color, Array, KeyValue), and improved state management with debounced saves and file locking.

## Components Added

### Widget Editor Panel
Floating panel that opens when a widget is selected:
- Dynamic form generation based on widget type schema
- Common properties section (title, title-url, hide-header, css-class, cache)
- Widget-specific properties rendered from definitions
- Real-time validation and updates

See: `frontend/src/components/WidgetEditor.tsx`

### Specialized Input Components

All inputs in `frontend/src/components/inputs/`:

| Component | Description |
|-----------|-------------|
| `DurationInput.tsx` | Duration picker with unit selector (s/m/h/d). Parses "30s", "5m", "2h", "1d" |
| `ColorInput.tsx` | HSL color picker with sliders (H: 0-360, S/L: 0-100) and text input |
| `ArrayInput.tsx` | Generic array editor with add/remove/reorder, min/max items validation |
| `KeyValueInput.tsx` | Key-value pair editor for headers, parameters, options |

## Widget Schema System

### Property Types Supported

| Type | UI Component | Description |
|------|--------------|-------------|
| `string` | Text input | Single-line text |
| `number` | Number input | With min/max/step |
| `boolean` | Checkbox | Toggle |
| `select` | Dropdown | Enum options |
| `duration` | DurationInput | Time duration (s/m/h/d) |
| `color` | ColorInput | HSL color picker |
| `url` | URL input | With validation |
| `array` | ArrayInput | Repeatable items |
| `object` | Nested group | Nested property groups |
| `text` | Textarea | Multi-line text |

### Schema Structure
Each widget type has a schema defining its properties:
- Property type and label
- Default values
- Required flag
- Validation rules (min/max for numbers and arrays)

See: `frontend/src/widgetDefinitions.ts` for all 27 widget schemas

## Widget Coverage

All 27 Glance widget types have property schemas:

### Content Widgets
- **rss:** feeds, style, limit, collapse-after, thumbnail-height, card-height, single-line-titles, preserve-order
- **bookmarks:** groups with nested links array, style
- **hacker-news/lobsters/reddit:** limit, collapse-after, sort options, subreddit

### Utility Widgets
- **clock:** hour-format, timezone, locale
- **calendar:** start-sunday, first-day-of-week
- **weather:** location, units, hour-format, hide-location
- **search:** search-engine, bangs, autofocus, new-tab

### Monitoring Widgets
- **monitor:** sites array (url, title, icon, check-interval), style
- **docker-containers:** hide-by-default, sort-by
- **dns-stats:** service, url, token, credentials

### Developer Widgets
- **releases:** repositories array (owner, repo, token, include-prereleases)
- **repository:** owner, repo, pull-requests, issues, commits
- **custom-api:** url, method, headers, body, template, frameless

## State Management Improvements

### Debounced Saves
Config saves are debounced (300ms) to:
- Reduce server load during rapid editing
- Prevent file corruption from concurrent writes
- Improve perceived performance with optimistic updates

Implementation: `frontend/src/hooks/useConfig.ts`

### File Locking (Backend)
- File lock during write operations
- Queue system for concurrent write requests
- Atomic writes with temp file and rename
- Backup creation before each save

Implementation: `backend/src/services/configService.js`

## Architecture Decisions

### Schema-Driven Forms
Widget forms are generated dynamically from schema definitions rather than individual form components per widget type. Benefits:
- Reduces code duplication
- Easier to add new widget types
- Ensures consistency across all widget editors
- Enables future schema validation integration

### HSL Color Model
Used HSL (Hue, Saturation, Lightness) for color inputs because:
- Matches Glance's native color format
- More intuitive for users than RGB/Hex
- Easier to create color variations (e.g., lighter/darker shades)

## Test Status

Tests updated to accommodate new functionality:
- `App.test.tsx` - Updated for new UI
- `PageList.test.tsx` - Updated styling
- `Preview.test.tsx` - Updated device sizes

## Superseded

- CSS styles were replaced with Tailwind in v0.4.7

## Known Issues (at v0.3)

1. Large forms can cause slight lag - consider virtualization
2. Some edge HSL values may not parse correctly
3. Array reordering uses buttons, could use drag-and-drop (added in v0.4.5)

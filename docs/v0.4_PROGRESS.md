# v0.4 - Advanced Features

**Date:** January 10, 2026  
**Status:** Complete

## Overview

Major features added: Theme Designer with presets, Monaco YAML editor with auto-completion, Environment Variables Manager, Validation Panel, and Custom API Widget Builder with Go template support.

## Components Added

### Theme Designer
Visual theme editor with:
- HSL color pickers for all theme properties (background-color, primary-color, positive-color, negative-color)
- Built-in presets: dark-default, light-default, nord, gruvbox, dracula, solarized-dark, solarized-light
- Custom preset save/delete
- Light/dark mode toggle
- Contrast multiplier slider (0.5 - 2.0)
- Text saturation multiplier slider
- Custom CSS file path input
- Disable theme picker option

HSL color parsing supports both "240 13 95" and "hsl(240, 13%, 95%)" formats.

See: `frontend/src/components/ThemeDesigner.tsx`

### Code Editor (Monaco)
Professional YAML editing with:
- Monaco editor integration via `@monaco-editor/react`
- Syntax highlighting
- YAML auto-completion for Glance-specific properties
- Bidirectional sync between code editor and visual editor
- Toolbar: Format, Revert, Apply Changes buttons
- Validation warnings (detects tabs, common YAML errors)
- Unsaved changes indicator

**Auto-completions include:**
- Top-level keys: pages, theme, branding, server
- Widget type snippets: rss, weather, clock, etc.
- Common properties: title, cache, columns

See: `frontend/src/components/CodeEditor.tsx`

### Environment Variables Manager
Detection and management of environment variable patterns:
- `${VAR_NAME}` - Standard environment variables
- `${secret:name}` - Docker secrets from `/run/secrets/`
- `${readFileFromEnv:VAR}` - Read file path from environment variable

Features:
- Variable listing with usage count and line locations
- Mock value editor for preview functionality
- Export to docker-compose.yml environment/secrets snippet
- Export to .env file format
- Filter/search by name or type

See: `frontend/src/components/EnvVarManager.tsx`

### Validation Panel
Real-time configuration validation:

**Validation Checks:**
- Page existence and names
- Page slug validation (reserved slugs: api, login, logout, static, assets, manifest.json)
- Slug duplication check
- Column requirements (at least one full column, max 2 full columns)
- Widget type validation (must be known type)
- Widget-specific validations:
  - RSS feeds require URL
  - Weather requires location
  - Reddit requires subreddit
  - Custom API requires URL and template
- Theme color format validation
- Contrast multiplier range validation

**Severity Levels:**
- `error` - Must fix before config will work
- `warning` - May cause issues
- `info` - Suggestions

Features:
- Summary counts (errors, warnings, info)
- Click-to-navigate to issue location (added in v0.5)
- Validation badge in toolbar showing issue count

See: `frontend/src/components/ValidationPanel.tsx`

### Custom API Widget Builder
Three-tab interface for custom-api widgets:

**1. Request Tab:**
- HTTP method selector (GET, POST, PUT, DELETE, PATCH)
- URL input
- Headers editor (add/remove key-value pairs)
- Request body editor (for POST/PUT/PATCH)
- Parameters editor for template interpolation
- Frameless option toggle

**2. Template Tab:**
- Monaco editor with custom Go template language support
- Syntax highlighting for Go template constructs
- Auto-completion for:
  - Control structures: `{{range}}`, `{{if}}`, `{{if-else}}`, `{{with}}`
  - JSON accessors: `.JSON.String()`, `.JSON.Array()`, `.JSON.Get()`
  - 36+ template functions
- Sample templates for common use cases
- Function reference panel

**3. Test Tab:**
- Send test request to API endpoint
- View response body, status code, headers
- Error handling and display

**Go Template Functions Supported:**
- Type conversion: toFloat, toInt, toString
- Math: add, sub, mul, div, mod
- Formatting: formatNumber, formatTime, parseTime
- Time: now, offsetNow, duration, startOfDay, endOfDay
- String: trimPrefix, trimSuffix, trimSpace, replaceAll, contains, hasPrefix, hasSuffix, toUpper, toLower, split, join, concat
- Collections: len, index, first, last, slice, sortAsc, sortDesc, unique, filter
- Regex: findMatch, findAllMatches, replaceMatches
- JSON: json, sjson

See: `frontend/src/components/CustomApiBuilder.tsx`

## Dependencies Added

```json
{
  "@monaco-editor/react": "^4.6.0"
}
```

## Architecture Decisions

### Monaco Editor Integration
Chose `@monaco-editor/react` for:
- Professional code editing experience
- Extensible language support (custom Go template language)
- Built-in syntax highlighting
- Auto-completion customization via monaco API

### Floating Panel System
Implemented floating panels instead of modals for:
- Better visibility of context while editing
- Multiple panels can be positioned
- Non-blocking interaction
- Consistent UI pattern across all advanced features

### Validation Architecture
Separated validation logic from UI:
- Validation functions are pure and testable
- Easy to add new validation rules
- Can be used for pre-save validation
- Reusable across components

See: Validation logic in `frontend/src/components/ValidationPanel.tsx`

## Test Coverage

172 tests total:
- ThemeDesigner: 15 tests
- CodeEditor: 11 tests
- EnvVarManager: 19 tests
- ValidationPanel: 24 tests
- CustomApiBuilder: 23 tests
- App (updated): 17 tests
- Other components: 63 tests

## Superseded

- CSS additions (~800 lines) were replaced with Tailwind in v0.4.7

## Known Limitations (at v0.4)

1. API Proxy not implemented - Test requests need backend proxy for CORS (added in v0.5)
2. Go Template Preview not implemented - Would require WASM Go template engine
3. Large configs may cause Monaco performance issues
4. Theme changes don't preview live in editor (only in Glance iframe)

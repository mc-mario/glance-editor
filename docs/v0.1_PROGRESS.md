# v0.1 - Core Infrastructure

**Date:** January 7, 2026  
**Status:** Complete

## Overview

Phase 1 established the foundation for the Glance Visual Editor: Docker setup, Express backend, React/TypeScript frontend, WebSocket for live updates, and basic YAML read/write operations.

## Architecture

### Technology Stack
- **Backend:** Node.js 20, Express.js, YAML parser (`yaml` package), WebSocket (`ws`), file watcher (`chokidar`)
- **Frontend:** React 18, TypeScript, Vite (build), Vitest (testing)
- **Deployment:** Multi-stage Dockerfile, docker-compose with Glance + Editor containers

### Project Structure
```
glance-editor/
├── backend/
│   └── src/
│       ├── server.js           # Express server setup
│       ├── routes/config.js    # Config API endpoints
│       ├── routes/health.js    # Health checks
│       └── services/
│           ├── configService.js # YAML read/write logic
│           └── websocket.js     # Real-time updates
├── frontend/
│   └── src/
│       ├── App.tsx             # Main app with sidebar + preview
│       ├── components/
│       │   ├── Preview.tsx     # Glance iframe
│       │   └── StatusBadge.tsx # WebSocket status
│       ├── hooks/
│       │   └── useConfig.ts    # Config state management
│       └── services/api.ts     # Backend client
├── config/glance.yml           # Sample config for testing
├── Dockerfile                  # Multi-stage build
├── docker-compose.yml          # Production setup
└── docker-compose.dev.yml      # Development with hot reload
```

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/health` | Health check with timestamp |
| GET | `/api/healthz` | Simple readiness probe |
| GET | `/api/config` | Get parsed config + raw YAML |
| GET | `/api/config/raw` | Get raw YAML only |
| PUT | `/api/config` | Update config (JSON) |
| PUT | `/api/config/raw` | Update config (raw YAML) |

Implementation: `backend/src/routes/config.js`

## Technical Decisions

### Atomic File Writes
To prevent Glance from reading partial files during writes:
1. Write to temporary file (`glance.yml.tmp`)
2. Create backup of existing file (`glance.yml.backup`)
3. Rename temp to final (atomic on most filesystems)

See: `backend/src/services/configService.js`

### WebSocket Integration
- Backend broadcasts `config-changed` events when file changes detected
- Frontend auto-reconnects with exponential backoff
- Used to refresh preview when external changes occur

See: `backend/src/services/websocket.js`, `frontend/src/hooks/useConfig.ts`

### Debounce Timing
- **Glance reload:** 500ms debounce on file changes (Glance's behavior)
- **Editor wait:** 600ms after writes before assuming Glance has reloaded

### CI/CD Pipeline
GitHub Actions workflow runs on push/PR to main:
1. `backend-test` - Lint and test backend
2. `frontend-test` - Lint and test frontend
3. `build` - Build Docker image
4. `integration-test` - Spin up containers, test API

See: `.github/workflows/ci.yml`

## Test Coverage

- **Backend:** 13 tests (health API, config API, configService)
- **Frontend:** 16 tests (App, Preview, StatusBadge)

## Superseded

- Initial CSS styles in `frontend/src/index.css` were replaced with Tailwind CSS in v0.4.7

## Known Limitations (at v0.1)

1. No authentication - Editor is open
2. Single user - No conflict resolution for concurrent edits
3. No undo/redo - Added in v0.5
4. Comments not preserved - YAML regeneration loses comments

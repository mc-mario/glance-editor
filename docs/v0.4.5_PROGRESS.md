# v0.4.5 - UX Improvements

**Date:** January 10, 2026  
**Status:** Complete

## Overview

UX improvements based on user feedback: N8N-style right sidebar for widget settings, improved color contrast, clickable empty columns, and smooth animated drag-and-drop.

## Changes

### 1. Right Sidebar for Widget Settings (N8N-style)

Replaced floating widget palette with a permanent right sidebar that opens widget settings when selecting a widget.

**Implementation:**
- Added `rightSidebarContent` and `rightSidebarCollapsed` state to App.tsx
- Created `RightSidebarContent` type: `'widget-editor' | 'widget-palette'`
- Widget selection auto-opens sidebar with widget editor
- Sidebar can be collapsed/expanded with icon buttons
- Added column selector to widget palette for direct widget placement

See: `frontend/src/App.tsx` (sidebar state management)

**Widget Palette Updates:**
- Added `onAddToColumn` prop for adding directly to specific column
- Added `columns` prop to show column options

See: `frontend/src/components/WidgetPalette.tsx`

### 2. Improved Color Contrast

Enhanced visibility for text, icons, and muted elements.

**CSS Variable Changes:**

| Variable | Before | After |
|----------|--------|-------|
| `--bg-secondary` | `var(--nord1)` | `#323846` |
| `--bg-tertiary` | `var(--nord2)` | `#3d4555` |
| `--bg-elevated` | `var(--nord3)` | `#4a5264` |
| `--text-primary` | `var(--nord6)` | `#f0f4f8` |
| `--text-secondary` | `var(--nord4)` | `#c8d0dc` |
| `--text-muted` | `var(--nord3)` | `#8892a2` |
| `--accent` | `var(--nord8)` | `#8dd4e0` |
| `--border` | `var(--nord2)` | `#4a5568` |

These explicit hex values improved contrast ratios while maintaining the Nord color aesthetic.

See: `frontend/src/index.css`

### 3. Clickable Empty Column State

Made empty columns clickable cards that open the widget palette.

**Implementation:**
- Wrapped empty column content in clickable div
- `onClick={onOpenWidgetPalette}` handler
- Keyboard support: `Enter`/`Space` to activate
- New CSS class `.layout-column-empty-clickable` with hover/focus states
- Updated hint text: "Drop widgets here or click to browse"

See: `frontend/src/components/LayoutEditor.tsx`

### 4. Animated Drag and Drop (Fixed)

Resolved flickering issues during drag operations.

**Initial Issues:**
1. `handleDragOver` fired on every mouse move causing constant re-renders
2. Both placeholder div AND shift transforms were applied (double movement)
3. Complex placeholder logic had edge cases causing flickering
4. `dragLeave` fired incorrectly when moving between child elements

**Final Solution:**

**Throttling:**
Added 50ms throttle to `handleDragOver`:
```tsx
const lastDragUpdateRef = useRef<number>(0);
const DRAG_THROTTLE_MS = 50;

const handleDragOver = useCallback((e, columnIndex, widgetIndex) => {
  e.preventDefault();
  const now = Date.now();
  if (now - lastDragUpdateRef.current < DRAG_THROTTLE_MS) return;
  lastDragUpdateRef.current = now;
  // ... update state
}, []);
```

**Placeholder-Only Approach:**
Removed shift transforms entirely:
- Placeholder animates with `scaleY(0)` to `scaleY(1)`
- DOM flow naturally pushes other elements down
- No conflicting CSS transforms

**Removed DragLeave Handler:**
Target position only resets on `dragEnd` or `drop`.

**Pointer Events:**
Added `pointer-events: none` to dragged elements to prevent them from being drag targets.

See: `frontend/src/components/LayoutEditor.tsx`, `frontend/src/components/PageList.tsx`

## Test Coverage

170 tests passing after changes.

## Superseded

- The Tailwind migration plan in this phase's original notes was executed in v0.4.7
- Color variable changes were preserved in the Tailwind theme configuration

## Next Steps (Planned)

Migration to Tailwind CSS was planned here and executed in v0.4.7. The hybrid approach was recommended:
- Keep CSS variables in `globals.css` for colors/theming
- Convert component styles to Tailwind utility classes inline
